{% extends "base.html" %}
{% block content %}

<div class="section-title">Simulation Results</div>
<div class="section-sub">
  Dataset: <code>{{ dataset }}</code> · Sigma: <code>{{ sigma }}</code>
  {% if yara %} · YARA: <code>{{ yara }}</code>{% endif %}
</div>

<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="metric-box">
      <div class="metric-value">{{ metrics.total_logs }}</div>
      <div class="metric-label">Total Logs</div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="metric-box">
      <div class="metric-value">{{ metrics.total_alerts }}</div>
      <div class="metric-label">Alerts</div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="metric-box">
      <div class="metric-value">{{ metrics.alerts_per_severity|length }}</div>
      <div class="metric-label">Severities</div>
    </div>
  </div>
</div>

<h5 class="mt-4">Executive Report (PDF)</h5>
<iframe
  src="{{ url_for('download_output', filename=pdf_file) }}"
  width="100%"
  height="420"
></iframe>

<a
  href="{{ url_for('download_output', filename=pdf_file) }}"
  class="btn btn-primary w-100 mt-3"
  target="_blank"
>
  Open Full Report
</a>

<hr class="my-4">

<h5>Alerts by Severity</h5>
<ul class="clean-list">
  {% for sev, count in metrics.alerts_per_severity.items() %}
  <li>{{ sev }} — <strong>{{ count }}</strong></li>
  {% endfor %}
</ul>

<h5 class="mt-4">Top Rules</h5>
<ul class="clean-list">
  {% for rule, count in metrics.alerts_per_rule|dictsort(by='value', reverse=true) %}
    {% if loop.index0 < 5 %}
    <li><code>{{ rule }}</code> — {{ count }} alerts</li>
    {% endif %}
  {% endfor %}
</ul>

<h5 class="mt-4">Alerts by Host</h5>
<ul class="clean-list">
  {% for host, count in metrics.alerts_per_host.items() %}
  <li>{{ host }} — {{ count }} alerts</li>
  {% endfor %}
</ul>

<a href="{{ url_for('index') }}" class="btn btn-outline-primary mt-4 w-100">
  ← Run Another Simulation
</a>

{% endblock %}
